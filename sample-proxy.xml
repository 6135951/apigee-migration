<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<APIProxy name="oauth-sample-proxy" revision="1">
    <DisplayName>OAuth Sample API</DisplayName>
    <Description>Sample Apigee proxy with various policies for migration testing</Description>
    
    <ProxyEndpoints>
        <ProxyEndpoint name="default">
            <HTTPProxyConnection>
                <BasePath>/oauth-api/v1</BasePath>
                <VirtualHost>default</VirtualHost>
                <VirtualHost>secure</VirtualHost>
            </HTTPProxyConnection>
            
            <PreFlow name="PreFlow">
                <Request>
                    <Step>
                        <Name>VerifyAPIKey</Name>
                    </Step>
                    <Step>
                        <Name>OAuth2</Name>
                    </Step>
                    <Step>
                        <Name>SpikeArrest</Name>
                    </Step>
                </Request>
                <Response>
                    <Step>
                        <Name>AddCORSHeaders</Name>
                    </Step>
                </Response>
            </PreFlow>
            
            <Flows>
                <Flow name="GetUserProfile">
                    <Condition>request.verb = "GET" and proxy.pathsuffix = "/profile"</Condition>
                    <Request>
                        <Step>
                            <Name>Quota</Name>
                        </Step>
                        <Step>
                            <Name>ExtractUserData</Name>
                        </Step>
                    </Request>
                    <Response>
                        <Step>
                            <Name>XMLtoJSON</Name>
                        </Step>
                    </Response>
                </Flow>
                
                <Flow name="ProcessPayment">
                    <Condition>request.verb = "POST" and proxy.pathsuffix = "/payment"</Condition>
                    <Request>
                        <Step>
                            <Name>ValidatePayload</Name>
                        </Step>
                        <Step>
                            <Name>JavaScript</Name>
                        </Step>
                        <Step>
                            <Name>ServiceCallout</Name>
                        </Step>
                    </Request>
                    <Response>
                        <Step>
                            <Name>JSONtoXML</Name>
                        </Step>
                    </Response>
                </Flow>
            </Flows>
            
            <PostFlow name="PostFlow">
                <Response>
                    <Step>
                        <Name>LogAnalytics</Name>
                    </Step>
                </Response>
            </PostFlow>
            
        </ProxyEndpoint>
    </ProxyEndpoints>
    
    <TargetEndpoints>
        <TargetEndpoint name="backend-service">
            <HTTPTargetConnection>
                <URL>https://backend.example.com</URL>
            </HTTPTargetConnection>
        </TargetEndpoint>
    </TargetEndpoints>
    
    <Policies>
        <Policy>
            <PolicyType>VerifyAPIKey</PolicyType>
            <Name>VerifyAPIKey</Name>
        </Policy>
        <Policy>
            <PolicyType>OAuthV2</PolicyType>
            <Name>OAuth2</Name>
        </Policy>
        <Policy>
            <PolicyType>SpikeArrest</PolicyType>
            <Name>SpikeArrest</Name>
        </Policy>
        <Policy>
            <PolicyType>Quota</PolicyType>
            <Name>Quota</Name>
        </Policy>
        <Policy>
            <PolicyType>JavaScript</PolicyType>
            <Name>JavaScript</Name>
        </Policy>
        <Policy>
            <PolicyType>ServiceCallout</PolicyType>
            <Name>ServiceCallout</Name>
        </Policy>
        <Policy>
            <PolicyType>XMLtoJSON</PolicyType>
            <Name>XMLtoJSON</Name>
        </Policy>
        <Policy>
            <PolicyType>JSONtoXML</PolicyType>
            <Name>JSONtoXML</Name>
        </Policy>
        <Policy>
            <PolicyType>CustomPolicy</PolicyType>
            <Name>ExtractUserData</Name>
        </Policy>
        <Policy>
            <PolicyType>CustomPolicy</PolicyType>
            <Name>ValidatePayload</Name>
        </Policy>
        <Policy>
            <PolicyType>CustomPolicy</PolicyType>
            <Name>AddCORSHeaders</Name>
        </Policy>
        <Policy>
            <PolicyType>CustomPolicy</PolicyType>
            <Name>LogAnalytics</Name>
        </Policy>
    </Policies>
    
</APIProxy>